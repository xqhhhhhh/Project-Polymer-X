# Project Polymer-X 系统设计

## 目标与规模
- 监控 500 个化工网站的每日更新
- 每日新增文本 10GB
- 需要高并发抓取、稳定解析、增量清洗、持续产出结构化与训练数据

## 架构概述
分布式爬虫 + 异步清洗流水线，核心组件：Scrapy-Redis、Kafka、Spark、Airflow、对象存储、元数据中心。

```
┌───────────────┐     ┌───────────────┐      ┌───────────────┐
│   站点配置库   │     │   任务调度器   │      │   代理池/UA   │
│ (YAML/DB)     │───▶│  Airflow      │───▶  │  反爬策略     │
└───────────────┘     └───────────────┘      └───────────────┘
         │                      │
         ▼                      ▼
┌─────────────────────────────────────────────┐
│           分布式爬虫集群 (Scrapy-Redis)      │
│  - URL 队列/去重 (Redis)                     │
│  - AsyncIO + 并发下载                         │
│  - Headless 渲染 (Playwright/Selenium)       │
└─────────────────────────────────────────────┘
         │
         ▼
┌────────────────────┐      ┌────────────────────┐
│ 原始数据落盘        │      │ 实时消息队列        │
│ (S3/MinIO/HDFS)     │◀────│ Kafka (raw-topic)   │
└────────────────────┘      └────────────────────┘
         │                           │
         ▼                           ▼
┌─────────────────────────────────────────────┐
│            清洗与解析集群 (Spark)            │
│  - HTML/PDF 解析                             │
│  - Schema 对齐/单位换算                      │
│  - 数据校验/异常检测                         │
└─────────────────────────────────────────────┘
         │
         ▼
┌────────────────────┐      ┌────────────────────┐
│ 结构化数据仓库       │      │ 训练数据构建        │
│ (Delta/Iceberg)     │───▶  │ JSONL 生成服务      │
└────────────────────┘      └────────────────────┘
         │                           │
         ▼                           ▼
┌────────────────────┐      ┌────────────────────┐
│ 监控/告警            │      │ 数据质量平台        │
│ (Prometheus/Grafana)│      │ 规则 + 统计分析     │
└────────────────────┘      └────────────────────┘
```

## 关键设计点
1. **高并发抓取**：Scrapy-Redis 统一调度与去重，异步抓取与限速控制。
2. **动态渲染**：对 JS-heavy 页面设置渲染队列，Playwright 集群独立扩缩容。
3. **断点续传**：URL 队列持久化 + 下载状态表，失败重试与回补任务。
4. **反爬策略**：IP 池、UA 轮换、Header 指纹、多线路出口。
5. **解析容错**：HTML/PDF 解析失败进入死信队列，人工回放与规则迭代。
6. **Schema 对齐**：字段字典 + 单位换算服务，所有清洗结果统一入仓。
7. **数据质量**：密度/熔融指数范围校验，异常值标记与人工复核。

## 扩展与成本控制
- 热点站点优先增量抓取，低频站点批处理。
- 解析规则与模型结合：规则优先，模型补充抽取。
- 计算资源按任务分组弹性伸缩，降低峰值成本。
